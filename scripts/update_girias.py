#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
üáßüá∑ Mapa Interativo de G√≠rias Brasileiras - Sistema de Atualiza√ß√£o
Sistema Python para enriquecer e validar dados das g√≠rias regionais
Autor: Jo√£o Lucas de Oliveira
"""

import json
import re
import random
from typing import Dict, List, Any
from dataclasses import dataclass
from pathlib import Path

@dataclass
class Giria:
    termo: str
    significado: str
    exemplo: str
    contexto: str = "informal"
    frequencia: str = "comum"
    origem: str = ""
    sinonimos: List[str] = None
    categoria: str = "express√£o"

class GiriasUpdater:
    """Sistema inteligente para atualiza√ß√£o e valida√ß√£o de g√≠rias brasileiras"""
    
    def __init__(self):
        self.base_path = Path(__file__).parent.parent
        self.girias_file = self.base_path / "girias.json"
        
        # Base expandida de g√≠rias aut√™nticas por estado
        self.new_girias_data = {
            "ac": {
                "estado": "Acre",
                "girias": [
                    {"termo": "gaiato", "significado": "pessoa engra√ßada, brincalhona", "exemplo": "Esse cara √© muito gaiato, sempre fazendo piada!", "contexto": "informal", "categoria": "personalidade"},
                    {"termo": "cabra macho", "significado": "homem corajoso, valente", "exemplo": "Aquele cabra macho enfrentou a on√ßa sozinho.", "contexto": "regional", "categoria": "qualidade"},
                    {"termo": "manauara", "significado": "pessoa de Manaus, amaz√¥nico", "exemplo": "Sou manauara de cora√ß√£o!", "contexto": "identidade", "categoria": "gent√≠lico"},
                    {"termo": "beiradeiro", "significado": "pessoa que mora nas margens dos rios", "exemplo": "Os beiradeiros conhecem todos os segredos da floresta.", "contexto": "regional", "categoria": "profiss√£o"},
                    {"termo": "encalacrado", "significado": "pessoa em situa√ß√£o dif√≠cil", "exemplo": "Fiquei encalacrado sem dinheiro na cidade.", "contexto": "informal", "categoria": "situa√ß√£o"},
                    {"termo": "piracema", "significado": "√©poca de reprodu√ß√£o dos peixes", "exemplo": "Na piracema n√£o pode pescar.", "contexto": "t√©cnico", "categoria": "natureza"},
                    {"termo": "coloca√ß√£o", "significado": "√°rea de trabalho do seringueiro", "exemplo": "Minha coloca√ß√£o fica rio acima.", "contexto": "regional", "categoria": "local"},
                    {"termo": "estrada de seringa", "significado": "caminho entre seringueiras", "exemplo": "Saiu cedo para correr a estrada de seringa.", "contexto": "hist√≥rico", "categoria": "trabalho"}
                ]
            },
            "al": {
                "estado": "Alagoas",
                "girias": [
                    {"termo": "oxente", "significado": "express√£o de espanto ou surpresa", "exemplo": "Oxente, que hist√≥ria √© essa?", "contexto": "informal", "categoria": "interjei√ß√£o"},
                    {"termo": "massa", "significado": "legal, bacana", "exemplo": "Essa festa t√° massa demais!", "contexto": "g√≠ria jovem", "categoria": "aprova√ß√£o"},
                    {"termo": "aperreado", "significado": "pessoa preocupada, aflita", "exemplo": "T√¥ aperreado com essa situa√ß√£o.", "contexto": "informal", "categoria": "sentimento"},
                    {"termo": "bichinho", "significado": "pessoa querida", "exemplo": "Que bichinho mais fofo!", "contexto": "carinhoso", "categoria": "afeto"},
                    {"termo": "cabra da peste", "significado": "pessoa esperta, danada", "exemplo": "Esse menino √© um cabra da peste mesmo.", "contexto": "regional", "categoria": "personalidade"},
                    {"termo": "brutamonte", "significado": "muito grande, imenso", "exemplo": "Uma casa brutamonte de bonita!", "contexto": "intensificador", "categoria": "tamanho"},
                    {"termo": "arig√≥", "significado": "pessoa n√£o muito inteligente", "exemplo": "N√£o seja arig√≥, rapaz!", "contexto": "pejorativo", "categoria": "personalidade"},
                    {"termo": "sem eira nem beira", "significado": "pessoa sem recursos", "exemplo": "Ficou sem eira nem beira depois da seca.", "contexto": "regional", "categoria": "situa√ß√£o"}
                ]
            },
            "sp": {
                "estado": "S√£o Paulo",
                "girias": [
                    {"termo": "mano", "significado": "amigo, parceiro", "exemplo": "E a√≠, mano, beleza?", "contexto": "informal", "categoria": "tratamento"},
                    {"termo": "bagulho", "significado": "coisa, objeto", "exemplo": "Pega aquele bagulho pra mim.", "contexto": "g√≠ria urbana", "categoria": "objeto"},
                    {"termo": "trampo", "significado": "trabalho, emprego", "exemplo": "Hoje tenho trampo at√© tarde.", "contexto": "informal", "categoria": "trabalho"},
                    {"termo": "m√≥", "significado": "muito, mega", "exemplo": "Esse filme √© m√≥ legal!", "contexto": "g√≠ria jovem", "categoria": "intensificador"},
                    {"termo": "paulista", "significado": "pessoa de SP", "exemplo": "Todo paulista √© corrido.", "contexto": "identidade", "categoria": "gent√≠lico"},
                    {"termo": "rol√™", "significado": "passeio, programa", "exemplo": "Vamos dar um rol√™ no centro?", "contexto": "g√≠ria jovem", "categoria": "atividade"},
                    {"termo": "quebrada", "significado": "bairro, regi√£o", "exemplo": "L√° na minha quebrada √© diferente.", "contexto": "g√≠ria urbana", "categoria": "local"},
                    {"termo": "sinistro", "significado": "legal, maneiro", "exemplo": "Essa festa t√° sinistra!", "contexto": "g√≠ria jovem", "categoria": "aprova√ß√£o"},
                    {"termo": "paia", "significado": "chato, ruim", "exemplo": "Que paia esse tr√¢nsito.", "contexto": "informal", "categoria": "desaprova√ß√£o"},
                    {"termo": "paulistano", "significado": "pessoa da capital", "exemplo": "Paulistano vive correndo.", "contexto": "identidade", "categoria": "gent√≠lico"},
                    {"termo": "maloqueiro", "significado": "pessoa da periferia", "exemplo": "Maloqueiro de cora√ß√£o!", "contexto": "identidade", "categoria": "social"},
                    {"termo": "z√© povinho", "significado": "pessoa comum do povo", "exemplo": "Sou z√© povinho mesmo.", "contexto": "popular", "categoria": "social"},
                    {"termo": "coruj√£o", "significado": "programa noturno, pessoa que sai √† noite", "exemplo": "Hoje tem coruj√£o no cinema.", "contexto": "informal", "categoria": "atividade"},
                    {"termo": "emba√ßado", "significado": "complicado, dif√≠cil", "exemplo": "A situa√ß√£o t√° emba√ßada.", "contexto": "g√≠ria urbana", "categoria": "situa√ß√£o"},
                    {"termo": "desenrolo", "significado": "jeitinho, habilidade para resolver", "exemplo": "Ele tem um bom desenrolo.", "contexto": "informal", "categoria": "habilidade"}
                ]
            },
            "rj": {
                "estado": "Rio de Janeiro",
                "girias": [
                    {"termo": "merm√£o", "significado": "irm√£o, parceiro", "exemplo": "Caraca, merm√£o, que doideira!", "contexto": "informal", "categoria": "tratamento"},
                    {"termo": "maneiro", "significado": "legal, bacana", "exemplo": "Esse filme t√° maneiro demais!", "contexto": "carioca", "categoria": "aprova√ß√£o"},
                    {"termo": "parada", "significado": "coisa, situa√ß√£o", "exemplo": "Essa parada t√° estranha.", "contexto": "g√≠ria urbana", "categoria": "situa√ß√£o"},
                    {"termo": "vacilo", "significado": "erro, besteira", "exemplo": "Foi um vacilo eu n√£o ter ido.", "contexto": "informal", "categoria": "erro"},
                    {"termo": "carioca", "significado": "pessoa do Rio de Janeiro", "exemplo": "Todo carioca ama a praia.", "contexto": "identidade", "categoria": "gent√≠lico"},
                    {"termo": "galera", "significado": "pessoal, turma", "exemplo": "A galera t√° chegando na praia.", "contexto": "informal", "categoria": "grupo"},
                    {"termo": "papo", "significado": "conversa", "exemplo": "Que papo √© esse, cara?", "contexto": "informal", "categoria": "comunica√ß√£o"},
                    {"termo": "mandar brasa", "significado": "ir com tudo", "exemplo": "Vou mandar brasa nessa festa!", "contexto": "informal", "categoria": "a√ß√£o"},
                    {"termo": "zona sul", "significado": "regi√£o nobre do Rio", "exemplo": "Vamos na zona sul hoje?", "contexto": "geogr√°fico", "categoria": "local"},
                    {"termo": "malandro", "significado": "pessoa esperta", "exemplo": "Esse malandro sabe se virar.", "contexto": "cultural", "categoria": "personalidade"},
                    {"termo": "ot√°rio", "significado": "pessoa ing√™nua", "exemplo": "N√£o seja ot√°rio, cara.", "contexto": "pejorativo", "categoria": "personalidade"},
                    {"termo": "barra pesada", "significado": "situa√ß√£o dif√≠cil", "exemplo": "A situa√ß√£o t√° barra pesada.", "contexto": "informal", "categoria": "situa√ß√£o"},
                    {"termo": "zoa√ß√£o", "significado": "brincadeira, bagun√ßa", "exemplo": "Isso √© s√≥ zoa√ß√£o.", "contexto": "informal", "categoria": "divers√£o"},
                    {"termo": "ral√©", "significado": "classe baixa", "exemplo": "Somos ral√© mesmo.", "contexto": "social", "categoria": "classe"}
                ]
            },
            "ba": {
                "estado": "Bahia",
                "girias": [
                    {"termo": "ax√©", "significado": "energia positiva, for√ßa", "exemplo": "Muito ax√© pra voc√™ hoje!", "contexto": "religioso-cultural", "categoria": "energia"},
                    {"termo": "arretado", "significado": "legal, bacana, incr√≠vel", "exemplo": "Essa m√∫sica √© arretada demais!", "contexto": "regional", "categoria": "aprova√ß√£o"},
                    {"termo": "bichinho", "significado": "pessoa querida, fofa", "exemplo": "Que bichinho mais fofo esse menino!", "contexto": "carinhoso", "categoria": "afeto"},
                    {"termo": "danado", "significado": "esperto, travesso", "exemplo": "Esse menino √© muito danado mesmo.", "contexto": "informal", "categoria": "personalidade"},
                    {"termo": "peba", "significado": "ruim, de baixa qualidade", "exemplo": "Esse filme √© muito peba.", "contexto": "informal", "categoria": "qualidade"},
                    {"termo": "avexado", "significado": "apressado, com pressa", "exemplo": "Para de ficar avexado, rapaz!", "contexto": "regional", "categoria": "comportamento"},
                    {"termo": "√©gua", "significado": "express√£o de espanto", "exemplo": "√âgua, que susto!", "contexto": "interjei√ß√£o", "categoria": "surpresa"},
                    {"termo": "mainha", "significado": "m√£e", "exemplo": "Mainha fez um almo√ßo arretado.", "contexto": "familiar", "categoria": "fam√≠lia"},
                    {"termo": "painho", "significado": "pai", "exemplo": "Painho chegou do trabalho.", "contexto": "familiar", "categoria": "fam√≠lia"},
                    {"termo": "aloprado", "significado": "doido, maluco", "exemplo": "Esse cara √© aloprado mesmo.", "contexto": "informal", "categoria": "personalidade"},
                    {"termo": "cafu√ßu", "significado": "caipira, interiorano", "exemplo": "Sou cafu√ßu do sert√£o.", "contexto": "identidade", "categoria": "origem"},
                    {"termo": "xod√≥", "significado": "pessoa querida, favorita", "exemplo": "Voc√™ √© meu xod√≥.", "contexto": "carinhoso", "categoria": "afeto"}
                ]
            }
        }
        
    def load_current_data(self) -> Dict[str, Any]:
        """Carrega dados atuais do arquivo JSON"""
        try:
            with open(self.girias_file, 'r', encoding='utf-8') as f:
                return json.load(f)
        except FileNotFoundError:
            return {}
    
    def validate_giria(self, giria: Dict[str, str]) -> bool:
        """Valida se uma g√≠ria tem todos os campos necess√°rios"""
        required_fields = ['termo', 'significado', 'exemplo']
        return all(field in giria and giria[field].strip() for field in required_fields)
    
    def enrich_giria(self, giria: Dict[str, str]) -> Dict[str, str]:
        """Enriquece uma g√≠ria com metadados adicionais"""
        enriched = giria.copy()
        
        # Adicionar contexto se n√£o existir
        if 'contexto' not in enriched:
            enriched['contexto'] = self.determine_context(giria['termo'])
        
        # Adicionar categoria se n√£o existir
        if 'categoria' not in enriched:
            enriched['categoria'] = self.determine_category(giria['termo'], giria['significado'])
        
        # Adicionar frequ√™ncia de uso
        if 'frequencia' not in enriched:
            enriched['frequencia'] = self.determine_frequency(giria['termo'])
        
        return enriched
    
    def determine_context(self, termo: str) -> str:
        """Determina o contexto de uso de uma g√≠ria"""
        contexts = {
            'interjei√ß√£o': ['oxente', 'eita', '√©gua', 'bah', 'uai'],
            'familiar': ['mainha', 'painho', 'vov√¥', 'vov√≥'],
            'g√≠ria jovem': ['m√≥', 'sinistro', 'paia', 'rol√™'],
            'regional': ['arretado', 'cabra', 'tch√™', 's√¥'],
            'urbano': ['bagulho', 'trampo', 'quebrada', 'parada']
        }
        
        for context, terms in contexts.items():
            if any(term in termo.lower() for term in terms):
                return context
        
        return 'informal'
    
    def determine_category(self, termo: str, significado: str) -> str:
        """Determina a categoria de uma g√≠ria baseada no significado"""
        categories = {
            'tratamento': ['amigo', 'parceiro', 'cara', 'mano'],
            'aprova√ß√£o': ['legal', 'bacana', 'bom', 'massa'],
            'personalidade': ['esperto', 'danado', 'esperta', 'malandro'],
            'sentimento': ['preocupado', 'aflito', 'feliz', 'triste'],
            'local': ['bairro', 'regi√£o', 'lugar', 'cidade']
        }
        
        significado_lower = significado.lower()
        for category, keywords in categories.items():
            if any(keyword in significado_lower for keyword in keywords):
                return category
        
        return 'express√£o'
    
    def determine_frequency(self, termo: str) -> str:
        """Determina a frequ√™ncia de uso estimada"""
        common_terms = ['mano', 'cara', 'legal', 'massa', 'bom']
        if any(term in termo.lower() for term in common_terms):
            return 'muito comum'
        return 'comum'
    
    def merge_data(self, current_data: Dict, new_data: Dict) -> Dict:
        """Mescla dados existentes com novos dados"""
        merged = current_data.copy()
        
        for estado_code, estado_data in new_data.items():
            if estado_code not in merged:
                merged[estado_code] = estado_data
            else:
                # Manter o nome do estado
                merged[estado_code]['estado'] = estado_data['estado']
                
                # Mesclar g√≠rias
                existing_terms = {g['termo'].lower() for g in merged[estado_code].get('girias', [])}
                
                for new_giria in estado_data['girias']:
                    if new_giria['termo'].lower() not in existing_terms:
                        merged[estado_code].setdefault('girias', []).append(new_giria)
                    else:
                        # Atualizar g√≠ria existente com novos campos
                        for i, existing_giria in enumerate(merged[estado_code]['girias']):
                            if existing_giria['termo'].lower() == new_giria['termo'].lower():
                                merged[estado_code]['girias'][i] = {**existing_giria, **new_giria}
                                break
        
        return merged
    
    def add_statistics(self, data: Dict) -> Dict:
        """Adiciona estat√≠sticas aos dados"""
        for estado_code, estado_data in data.items():
            girias = estado_data.get('girias', [])
            estado_data['estatisticas'] = {
                'total_girias': len(girias),
                'categorias': self.count_categories(girias),
                'contextos': self.count_contexts(girias),
                'ultima_atualizacao': '2025-01-02'
            }
        
        return data
    
    def count_categories(self, girias: List[Dict]) -> Dict[str, int]:
        """Conta g√≠rias por categoria"""
        categories = {}
        for giria in girias:
            cat = giria.get('categoria', 'express√£o')
            categories[cat] = categories.get(cat, 0) + 1
        return categories
    
    def count_contexts(self, girias: List[Dict]) -> Dict[str, int]:
        """Conta g√≠rias por contexto"""
        contexts = {}
        for giria in girias:
            ctx = giria.get('contexto', 'informal')
            contexts[ctx] = contexts.get(ctx, 0) + 1
        return contexts
    
    def save_data(self, data: Dict) -> None:
        """Salva dados atualizados no arquivo JSON"""
        with open(self.girias_file, 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=2)
    
    def update(self) -> None:
        """Executa processo completo de atualiza√ß√£o"""
        print("üáßüá∑ Iniciando atualiza√ß√£o das g√≠rias brasileiras...")
        
        # Carregar dados atuais
        current_data = self.load_current_data()
        print(f"üìä Dados atuais carregados: {len(current_data)} estados")
        
        # Enriquecer dados existentes
        for estado_code, estado_data in current_data.items():
            if 'girias' in estado_data:
                for i, giria in enumerate(estado_data['girias']):
                    current_data[estado_code]['girias'][i] = self.enrich_giria(giria)
        
        # Mesclar com novos dados
        merged_data = self.merge_data(current_data, self.new_girias_data)
        print(f"üîÑ Dados mesclados: {len(merged_data)} estados")
        
        # Adicionar estat√≠sticas
        final_data = self.add_statistics(merged_data)
        
        # Salvar dados atualizados
        self.save_data(final_data)
        
        # Estat√≠sticas finais
        total_girias = sum(len(estado['girias']) for estado in final_data.values())
        print(f"‚úÖ Atualiza√ß√£o conclu√≠da!")
        print(f"üìà Total de g√≠rias: {total_girias}")
        print(f"üó∫Ô∏è Estados cobertos: {len(final_data)}")
        print(f"üíæ Arquivo salvo: {self.girias_file}")

def main():
    """Fun√ß√£o principal"""
    try:
        updater = GiriasUpdater()
        updater.update()
    except Exception as e:
        print(f"‚ùå Erro durante atualiza√ß√£o: {e}")
        return 1
    
    return 0

if __name__ == "__main__":
    exit(main()) 